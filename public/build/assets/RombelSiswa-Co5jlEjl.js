import"./el-popper-BxfQEJds.js";import{v as le}from"./el-loading-CK2Lw3BS.js";/* empty css                  *//* empty css                   */import{E as oe}from"./el-scrollbar-fK2iBKQp.js";import{E as ae,a as se}from"./el-col-Cy6nAyh_.js";import{E as ne}from"./el-input-BgdrZhfW.js";/* empty css               */import{E as re,a as ie}from"./el-select-Br8TPRck.js";/* empty css                */import{E as me,a as de}from"./el-table-column-BWckAC3N.js";import"./el-checkbox-DCFV4V_x.js";import{E as ce}from"./el-button-3Ip_9Urw.js";import{Q as ue,r as d,h as I,B as pe,o as c,c as v,w as o,b as s,t as D,a as t,i as j,u as B,e as g,f as L,g as C,F as be,x as fe,D as F,A as U}from"./app-BXsEN59A.js";import{I as z}from"./iconify-DoFYDNe_.js";import{r as ve,u as _e}from"./xlsx-CBeNCG2-.js";import{E as he}from"./index-Be4rHDAV.js";import{E as ge}from"./index-OF6XvvP3.js";import"./index-CkGV8xCd.js";import"./typescript-Bp3YSIOJ.js";import"./event-HEVJa2N9.js";import"./index-ExjPFQwu.js";import"./use-form-item-C2hKDeat.js";import"./index-BlNNTmKD.js";import"./isEqual-C0_ORWOq.js";import"./scroll-Ca1Q_kqt.js";import"./debounce-nv22URmW.js";import"./index-C53zd3iQ.js";import"./castArray-COTUzLor.js";import"./_initCloneObject-D1FE-Fs5.js";import"./use-dialog-CFecfF9o.js";const we={class:"flex items-center justify-between"},ye={class:"dialog-title"},Ee={class:"dialog-body bg-slate-100 py-2"},ke={class:"flex items-center justify-between"},xe={class:"card-title flex items-center"},Ce={class:"card-toolbar flex"},Se={class:"card-body"},Re={class:"flex items-center justify-between"},Ne={class:"card-title flex items-center"},Ve={class:"card-toolbar flex"},Me={class:"flex items-center"},Ie={class:"card-body"},mt={__name:"RombelSiswa",props:{show:Boolean,selectedRombel:Object},emits:["close","refresh"],setup(K,{emit:O}){const T=ue(),r=K,k=O,u=d(!1),p=d([]),w=d(""),_=d([]),x=d(null),b=d([]),y=d(""),$=I(()=>p.value.filter(l=>!w.value||l.nama.toLowerCase().includes(w.value.toLowerCase()))),q=I(()=>b.value.filter(l=>!y.value||l.nama.toLowerCase().includes(y.value.toLowerCase()))),h=d([]),J=l=>{h.value=l},P=l=>{_.value=l},A=async()=>{await F.post(route("dashboard.rombel.member.detach",{id:r.selectedRombel.id}),{siswas:_.value},{onSuccess:l=>{k("refresh"),_.value.forEach(e=>{let i=p.value.findIndex(m=>m.id===e.id);p.value.splice(i,1),b.value.push(e)})}})},S=async()=>{await F.post(route("dashboard.rombel.member.attach",{id:r.selectedRombel.id}),{siswas:h.value},{onStart:()=>u.value=!0,onSuccess:l=>{k("refresh"),h.value.forEach(e=>{let i=b.value.findIndex(m=>m.id===e.id);b.value.splice(i,1),p.value.push(e)})},onFinish:()=>u.value=!1})},R=async()=>{await U.post(route("dashboard.siswa.nonmember",{_query:{rombelId:r.selectedRombel.id,targetRombel:x.value}})).then(l=>{b.value=l.data.siswas}).catch(l=>console.log(l))},Q=async()=>{S()},G=async l=>{const i=await l.target.files[0].arrayBuffer(),m=ve(i),n=m.Sheets[m.SheetNames[0]];_e.sheet_to_json(n).forEach(E=>{b.value.forEach(f=>{E.nisn==f.nisn&&(p.value.push(f),h.value.push(f))})})},N=d([]),H=async()=>{u.value=!0,U.get(route("dashboard.rombel.index",{_query:{currentRombel:r.selectedRombel.id,sekolahId:T.props.sekolahs[0].npsn}})).then(l=>{N.value=l.data.rombels,u.value=!1})};return pe(()=>{R(),p.value=r.selectedRombel.siswas,H()}),(l,e)=>{const i=ce,m=ne,n=me,E=de,f=he,V=ae,W=re,X=ie,Y=se,Z=oe,ee=ge,M=le;return c(),v(ee,{modelValue:r.show,"onUpdate:modelValue":e[3]||(e[3]=a=>r.show=a),fullscreen:"",onClose:e[4]||(e[4]=a=>k("close"))},{header:o(()=>[s("div",we,[s("div",ye," Manajemen Peserta Didik "+D(r.selectedRombel.label),1)])]),default:o(()=>[t(Z,{height:"90vh"},{default:o(()=>[s("div",Ee,[t(Y,{gutter:12},{default:o(()=>[t(V,{span:12},{default:o(()=>[j((c(),v(f,null,{header:o(()=>[s("div",ke,[s("div",xe,[t(B(z),{icon:"mdi:human-child",class:"mb-1 text-lg"}),g(" Data Peserta Didik "+D(r.selectedRombel.label),1)]),s("div",Ce,[!_.value.length>0?(c(),L("input",{key:0,type:"file",ref:"fileSiswa",onChange:G},null,544)):C("",!0),t(i,{type:"primary",size:"small",onClick:Q},{default:o(()=>e[5]||(e[5]=[g("Simpan")])),_:1}),_.value.length>0?(c(),v(i,{key:1,type:"danger",size:"small",onClick:A},{default:o(()=>e[6]||(e[6]=[g("Keluarkan")])),_:1})):C("",!0)])]),t(m,{modelValue:w.value,"onUpdate:modelValue":e[0]||(e[0]=a=>w.value=a),placeholder:"Cari Siswa",class:"mt-2"},null,8,["modelValue"])]),default:o(()=>[s("div",Se,[t(E,{data:$.value,onSelectionChange:P,height:"65vh"},{default:o(()=>[t(n,{type:"selection",width:"55"}),t(n,{label:"NISN",prop:"nisn"}),t(n,{label:"Nama",prop:"nama"}),t(n,{label:"JK",prop:"jk"})]),_:1},8,["data"])])]),_:1})),[[M,u.value]])]),_:1}),t(V,{span:12},{default:o(()=>[j((c(),v(f,null,{header:o(()=>[s("div",Re,[s("div",Ne,[t(B(z),{icon:"mdi:human-child",class:"mb-1 text-lg"}),e[7]||(e[7]=g(" Siswa belum masuk Rombel "))]),s("div",Ve,[h.value.length>0?(c(),v(i,{key:0,type:"primary",size:"small",onClick:S},{default:o(()=>e[8]||(e[8]=[g("Masukkan")])),_:1})):C("",!0)])]),s("div",Me,[t(X,{modelValue:x.value,"onUpdate:modelValue":e[1]||(e[1]=a=>x.value=a),placeholder:"Dari Rombel Lain",onChange:R},{default:o(()=>[(c(!0),L(be,null,fe(N.value,(a,te)=>(c(),v(W,{key:te,value:a.id,label:`${a.tapel} | ${a.label}`},null,8,["value","label"]))),128))]),_:1},8,["modelValue"]),t(m,{modelValue:y.value,"onUpdate:modelValue":e[2]||(e[2]=a=>y.value=a),placeholder:"Cari Siswa",class:"mt-2"},null,8,["modelValue"])])]),default:o(()=>[s("div",Ie,[t(E,{data:q.value,onSelectionChange:J,height:"65vh"},{default:o(()=>[t(n,{type:"selection",width:"55"}),t(n,{label:"NISN",prop:"nisn"}),t(n,{label:"Nama",prop:"nama"}),t(n,{label:"JK",prop:"jk"})]),_:1},8,["data"])])]),_:1})),[[M,u.value]])]),_:1})]),_:1})])]),_:1})]),_:1},8,["modelValue"])}}};export{mt as default};
