import"./el-popper-CaImQOyu.js";import{E as K,a as G}from"./Nilai-B9oK7wh_.js";import{E as J,a as L}from"./el-table-column-BNGLBdhX.js";import"./el-checkbox-CwFy4y1C.js";import"./el-scrollbar-eSEge-wK.js";import{E as Q}from"./el-input-sz4wU1yw.js";import"./el-popover-BvxHu4lO.js";/* empty css               *//* empty css                        */import{E as R,a as W}from"./el-button-DYt1oPSe.js";import{Q as X,r as k,z as Y,o as _,c as S,w as p,b as i,e as x,t as u,u as b,a as e,f as C,F as V,x as B,D as T,A as z}from"./app-DSVmZEKi.js";import{I as Z}from"./iconify--ESl54GR.js";import{r as ee,u as y,w as te}from"./xlsx-CBeNCG2-.js";import{E as ae}from"./index-BlbCqnu5.js";import{E as j}from"./index-Bcw9lRsO.js";import{E as le}from"./index-BTk7wLDx.js";import"./index-CH2Tk2ta.js";import"./DashLayout-DZQtduZ9.js";import"./el-divider-BV5q6UHO.js";/* empty css                         */import"./index-Cns6kdyt.js";import"./index-BxiTdpLB.js";import"./typescript-Bp3YSIOJ.js";import"./event-HEVJa2N9.js";import"./castArray-mnFg3Ne5.js";import"./index-CBkGLcYb.js";import"./index-DqcSeyRI.js";import"./isEqual-clAqURvA.js";import"./debounce-BQCk7hAm.js";import"./_initCloneObject-Dy11O6uP.js";import"./use-form-item-DBlcTQiz.js";import"./index-BPhvBLmT.js";import"./use-dialog-C_dmPDPa.js";import"./scroll-_juTpDpT.js";const se={class:"uppercase"},oe={class:"flex items-center justify-between"},ie={class:"text-sky-800 font-bold"},ne={class:"items flex items-center gap-6"},re={class:"dialog-body"},pe={class:"cursor-pointer"},me={class:"text-sky-700"},de={class:"font-bold text-sky-600"},Je={__name:"FormNilaiP5",props:{rombel:Object,open:Boolean,sekolah:Object,mapel:Object},emits:["close"],setup(F,{emit:P}){const n=X(),l=F,O=P,U=n.props.auth.roles[0],v=k(["TP1","TP2","TP3"]);k("UH");const h=k([]),w=k(!1),$=async()=>{var m;T.post(route("dashboard.nilai.store",{_query:{rombelId:l.rombel.kode,tingkat:l.rombel.tingkat,mapelId:(m=l.mapel)==null?void 0:m.kode,agama:n.props.auth.roles.includes("guru_agama")?n.props.auth.user.userable.agama:null,semester:n.props.periode.semester.kode,tapel:n.props.periode.tapel.kode,tipe:"uh"}}),{siswas:h.value},{onSuccess:t=>{T.reload({only:["nilais"]}),j({title:"Info",message:t.props.flash.message,type:"success"})},onError:t=>{Object.keys(t).forEach(s=>{setTimeout(()=>{j({title:"Error",message:t[s],type:"error"})},500)})}})},A=async()=>{var m;await z.post(route("dashboard.pembelajaran.tp.index",{_query:{tingkat:l.rombel.tingkat,mapelId:(m=l.mapel)==null?void 0:m.kode,agama:n.props.auth.roles.includes("guru_agama")?n.props.auth.user.userable.agama:null,semester:n.props.periode.semester.kode}})).then(t=>{v.value=t.data.tps,w.value=!1,l.rombel.siswas.forEach((s,o)=>{let a={};v.value.map((d,c)=>a[d.kode]=0),h.value.push({id:s.id,nisn:s.nisn,nama:s.nama,nilais:a,jk:s.jk,agama:s.agama})})})},D=async()=>{var m;await z.post(route("dashboard.nilai.index",{_query:{rombelId:l.rombel.kode,tingkat:l.rombel.tingkat,mapelId:(m=l.mapel)==null?void 0:m.kode,agama:n.props.auth.roles.includes("guru_agama")?n.props.auth.user.userable.agama:null,semester:n.props.periode.semester.kode,tapel:n.props.periode.tapel.kode,tipe:"uh"}})).then(t=>{t.data.length>0&&h.value.forEach(s=>{t.data.filter(o=>o.siswa_id==s.nisn).forEach(o=>{s.nilais[o.tp_id]=o.skor})})})},q=async m=>{const s=await m.target.files[0].arrayBuffer(),o=ee(s),a=o.Sheets[o.SheetNames[0]];if(o.SheetNames[0]!==l.mapel.kode)return j({title:"Error! Mapel Tidak Sesuai",message:"Mapel Nilai yang Anda impor tidak sesuai",type:"error"}),!1;const d=y.sheet_to_json(a);h.value.forEach(c=>{d.forEach(g=>{c.nisn==g.nisn&&Object.keys(g).forEach(f=>{["no","nisn","nama","jk","agama"].includes(f)||(c.nilais[f]=g[f])})})})},H=async()=>{let m=[];await h.value.forEach(o=>{let a={nisn:o.nisn,nama:o.nama,jk:o.jk,agama:o.agama};Object.keys(o.nilais).forEach(d=>{a[d]=o.nilais[d]}),m.push(a)});const t=y.json_to_sheet(m),s=y.book_new();y.book_append_sheet(s,t,l.mapel.kode),te(s,"Impor Nilai Harian "+l.mapel.label+" Kelas "+l.rombel.label+" Semester "+n.props.periode.semester.label+" "+n.props.periode.tapel.label+".xlsx")};return Y(async()=>{w.value=!0,await A(),await D()}),(m,t)=>{const s=R,o=W,a=K,d=J,c=le,g=Q,f=L,M=G;return _(),S(b(ae),{modelValue:l.open,"onUpdate:modelValue":t[1]||(t[1]=r=>l.open=r),fullscreen:"",onClose:t[2]||(t[2]=r=>O("close")),"show-close":!1},{header:p(({close:r,titleId:E,titleClass:N})=>[i("span",se,[i("span",oe,[i("div",null,[t[3]||(t[3]=i("small",null,"Nilai Harian",-1)),t[4]||(t[4]=x()),i("span",ie,u(l.mapel.label?l.mapel.label:l.mapel.kode.includes("pabp")?`Pendidikan Agama ${b(n).props.auth.user.userable.agama}`:l.mapel.kode.toUpperCase()),1),i("small",null,[x(" Â  "+u(l.rombel.label)+" ",1),i("span",null,u(b(U)!=="guru_kelas"?l.sekolah.nama:b(n).props.sekolahs[0].nama),1)])]),i("div",ne,[i("input",{type:"file",ref:"fileNilai",accept:".xls,.xlsx,.ods",onChange:q,class:"hidden"},null,544),e(o,null,{default:p(()=>[e(s,{type:"success",size:"small",onClick:H},{default:p(()=>t[5]||(t[5]=[x("Unduh Format")])),_:1}),e(s,{type:"warning",size:"small",onClick:t[0]||(t[0]=I=>m.$refs.fileNilai.click())},{default:p(()=>t[6]||(t[6]=[x("Impor")])),_:1}),e(s,{type:"primary",size:"small",onClick:$},{default:p(()=>t[7]||(t[7]=[x("Simpan")])),_:1})]),_:1}),e(s,{type:"danger",onClick:r,size:"small"},{default:p(()=>[e(b(Z),{icon:"mdi:close"})]),_:2},1032,["onClick"])])])])]),default:p(()=>[i("div",re,[e(M,{loading:w.value,animated:""},{template:p(()=>[(_(),C(V,null,B(16,r=>i("div",{key:r,style:{width:"100%",display:"flex","margin-bottom":"20px","align-items":"middle"}},[e(a,{variant:"text",style:{width:"50px",height:"30px",margin:"0 5px"}}),e(a,{variant:"text",style:{width:"100px",height:"30px",margin:"0 5px"}}),e(a,{variant:"text",style:{width:"50%",height:"30px",margin:"0 5px"}}),e(a,{variant:"text",style:{width:"50px",height:"30px",margin:"0 5px"}}),e(a,{variant:"text",style:{width:"50px",height:"30px",margin:"0 5px"}}),e(a,{variant:"text",style:{width:"40px",height:"30px",margin:"0 5px 0 20px"}}),e(a,{variant:"text",style:{width:"40px",height:"30px",margin:"0 5px"}}),e(a,{variant:"text",style:{width:"40px",height:"30px",margin:"0 5px"}}),e(a,{variant:"text",style:{width:"40px",height:"30px",margin:"0 5px"}}),e(a,{variant:"text",style:{width:"40px",height:"30px",margin:"0 5px"}}),e(a,{variant:"text",style:{width:"40px",height:"30px",margin:"0 5px"}}),e(a,{variant:"text",style:{width:"40px",height:"30px",margin:"0 5px"}}),e(a,{variant:"text",style:{width:"40px",height:"30px",margin:"0 5px"}}),e(a,{variant:"text",style:{width:"40px",height:"30px",margin:"0 5px"}}),e(a,{variant:"text",style:{width:"40px",height:"30px",margin:"0 5px"}}),e(a,{variant:"text",style:{width:"40px",height:"30px",margin:"0 5px"}}),e(a,{variant:"text",style:{width:"40px",height:"30px",margin:"0 5px"}}),e(a,{variant:"text",style:{width:"40px",height:"30px",margin:"0 5px"}})])),64))]),default:p(()=>[e(f,{data:l.rombel.siswas,height:"90vh",size:"small"},{default:p(()=>[e(d,{type:"index",label:"#",width:"50",fixed:""}),e(d,{label:"NISN",prop:"nisn",width:"120",fixed:""}),e(d,{label:"Nama",prop:"nama",fixed:""}),e(d,{label:"JK",width:"60"},{default:p(r=>[x(u(r.row.jk.substring(0,1)),1)]),_:1}),e(d,{label:"Agm",width:"55"},{default:p(r=>[x(u(r.row.agama.substring(0,2)),1)]),_:1}),(_(!0),C(V,null,B(v.value,(r,E)=>(_(),S(d,{key:E,width:"90"},{header:p(()=>[i("span",pe,[e(c,{placement:"bottom-end"},{reference:p(()=>[i("span",me,u(r.kode),1)]),default:p(()=>[i("div",null,[i("h3",de,[i("small",null,u(r.elemen),1)]),i("small",null,u(r.teks),1)])]),_:2},1024)])]),default:p(N=>[e(g,{modelValue:h.value[N.$index].nilais[r.kode],"onUpdate:modelValue":I=>h.value[N.$index].nilais[r.kode]=I,type:"number",tabindex:E,min:"0",max:"100",size:"small"},null,8,["modelValue","onUpdate:modelValue","tabindex"])]),_:2},1024))),128))]),_:1},8,["data"])]),_:1},8,["loading"])])]),_:1},8,["modelValue"])}}};export{Je as default};
